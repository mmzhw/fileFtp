(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56164606"],{"2c31":function(e,t,a){e.exports=a.p+"static/media/2.a25964a9.mp3"},3005:function(e,t,a){},"31a0":function(e,t,a){e.exports=a.p+"static/img/cardMove.37edf863.gif"},"541b":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n=function(e){var t=new Audio;return t.src=e,t.isCanPlay=!1,t.oncanplaythrough=function(){t.isCanPlay=!0},t.timeId=null,{play:function(){t&&(t.isCanPlay?(t.currentTime=0,t.play()):t.timeId||(t.timeId=setTimeout((function(){t.timeId=null,t.play()}),100)))},pause:function(){t&&(t.timeId&&clearTimeout(t.timeId),t.pause())},destroy:function(){t&&(t.timeId&&clearTimeout(t.timeId),t.pause(),t.pause(),t.src=null,t.oncanplaythrough=null,t=null)}}}},5491:function(e,t,a){e.exports=a.p+"static/media/3.cedb8ce9.mp3"},"54bf":function(e,t,a){"use strict";var n=a("b70f"),i=a.n(n);i.a},"672a":function(e,t,a){e.exports=a.p+"static/img/cardno_bg.6311445f.png"},8949:function(e,t,a){"use strict";var n=a("3005"),i=a.n(n);i.a},ab59:function(e,t,a){"use strict";a.d(t,"g",(function(){return i})),a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return s})),a.d(t,"h",(function(){return d})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return c})),a.d(t,"e",(function(){return u})),a.d(t,"f",(function(){return f}));a("d3b7");var n=a("b775"),i=function(e){return window.options.demo?new Promise((function(e){return e({code:"0",result:{userRecognitionId:6223},status:200,timeElapsed:47,timestamp:1594203029468})})):n["a"].ajax("/ssm/humanMgt/saveUserRecognition","post",e)},r=function(e){return n["a"].ajax("/ssm/humanMgt/getUserRegisterStatus","get",e)},s=function(e){return n["a"].ajax("/ssm/humanMgt/faceRecognition","POST",e)},d=function(e){return n["a"].ajax("/ssm/humanMgt/handleApply","post",e)},o=function(e){return n["a"].ajax("/ssm/humanMgt/getVerifyCode","post",e)},c=function(e){return n["a"].ajax("/ssm/humanMgt/verifyCode","post",e)},u=function(e){return n["a"].ajax("/ssm/humanMgt/getNoCriminalVerifyCode","post",e)},f=function(e){return n["a"].ajax("/ssm/humanMgt/noCriminalVerifyCode","post",e)}},b61d:function(e,t,a){e.exports=a.p+"static/media/2-0.7ef44ef0.mp3"},b70f:function(e,t,a){},ec31:function(e,t,a){e.exports=a.p+"static/img/cardnot_bg.43e5f3b8.png"},f7ef:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"kd-page-title"},[e._v("身份证信息识别")]),1!==e.currentState||e.disableReadCard||e.readComplete?e._e():a("div",{staticClass:"kd-content-wrapper carryingCard"},[a("img",{staticClass:"staticCard",attrs:{src:e.cardNoBg,alt:""}}),a("img",{staticClass:"moveCard",attrs:{src:e.cardMove,alt:""}}),a("div",{staticClass:"text",domProps:{innerHTML:e._s(e.tips)}})]),0!==e.currentState||e.disableInput||e.readComplete?e._e():a("div",{staticClass:"kd-content-wrapper notCarryingCard"},[a("img",{attrs:{src:e.cardNotBg,alt:""}}),e.disableInputName?e._e():a("kd-full-input",{ref:"identifyName",staticClass:"inputClass",attrs:{placeholder:"请输入您的姓名","watch-data":e.getIdentifyName}}),a("kd-full-input",{ref:"identifyNum",staticClass:"inputClass",attrs:{"ime-type":3,placeholder:"请输入您的身份证号码","watch-data":e.getIdentifyNum,"limit-number":18}}),a("div",{staticClass:"checkTips hide",class:{show:e.tipShowFlag}},[e._v("姓名或身份证格式不正确")])],1),e.readComplete&&e.generateCard?a("div",{staticClass:"kd-content-wrapper complete"},[a("id-number",{attrs:{identify:e.identifyCard,getIdentifyCardImg:e.getIdentifyCardImg}})],1):e._e(),e.$store.state.common.visibleTip?e._e():a("div",{staticClass:"kd-foot-button kd-foot-button-position"},[a("kd-button",{attrs:{icon:"kedaIcon-policework",text:"返回首页","type-class":"home"}}),a("kd-button",{attrs:{icon:"kedaIcon-zhongzhi",text:"返回","button-handle":e.backMenu}}),e.CONSTANT.localContrast||e.disableInput||1!==e.currentState?e._e():a("kd-button",{attrs:{text:"未携带身份证","button-handle":e.changIdentifyState}}),e.disableReadCard||0!==e.currentState?e._e():a("kd-button",{attrs:{text:"已携带身份证","button-handle":e.changIdentifyState}}),0===e.currentState&&e.disableInputName?a("kd-button",{attrs:{icon:"kedaIcon-circlecheckoutline",text:"确定","button-handle":e.sureIdentifyNum,"but-disable":!e.identifyNumMatch}}):e._e(),0!==e.currentState||e.disableInputName?e._e():a("kd-button",{attrs:{icon:"kedaIcon-circlecheckoutline",text:"确定","button-handle":e.sureIdentifyNum,"but-disable":!e.identifyNumMatch&&!e.identifyNameMatch}})],1)])},i=[],r=(a("b0c0"),a("96cf"),a("1da1")),s=a("5530"),d=a("2f62"),o=a("ab59"),c=a("faf3"),u=a("b2eb"),f=a("b893"),m=a("2435"),l=a("672a"),p=a.n(l),b=a("31a0"),h=a.n(b),g=a("ec31"),y=a.n(g),C=a("ed08"),N=a("b61d"),I=a.n(N),v=a("2c31"),k=a.n(v),S=a("5491"),x=a.n(S),T=a("541b"),_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.isComplete?e._e():a("div",{ref:"idWrap",staticClass:"idWrap"},[a("p",{staticClass:"fontTop name"},[e._v(e._s(e.identify.partyName))]),a("p",{staticClass:"fontTop sex"},[e._v(e._s(1===e.identify.gender?"男":"女"))]),a("p",{staticClass:"fontTop mz"},[e._v(e._s(e.identify.nation))]),a("p",{staticClass:"fontTop year"},[e._v(e._s(e.year))]),a("p",{staticClass:"fontTop mounth"},[e._v(e._s(e.mouth))]),a("p",{staticClass:"fontTop day"},[e._v(e._s(e.day))]),a("p",{staticClass:"fontTop address"},[e._v(e._s(e.identify.certAddress))]),a("p",{staticClass:"fontTop idNum"},[e._v(e._s(e.identify.certNumber))]),a("p",{staticClass:"fontTop certOrg"},[e._v(e._s(e.identify.certOrg))]),a("p",{staticClass:"fontTop time"},[e._v(e._s(e.birthdayStart)+"-"+e._s(e.birthdayEnd))]),a("canvas",{ref:"currentCanvas",staticClass:"headPic"})]),e.isComplete?a("img",{staticClass:"imgWrap",attrs:{src:e.baseImg,alt:""}}):e._e()])},O=[],j=(a("d3b7"),a("c0e9")),w=a.n(j),M={name:"idNumber",data:function(){return{baseImg:"",newHeadPic:"",isComplete:!1,year:"",mouth:"",day:"",birthdayStart:"",birthdayEnd:""}},props:{identify:{type:Object,default:function(){}},getIdentifyCardImg:{type:Function}},mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.year=e.$moment(e.identify.bornDay).format("YYYY"),e.mouth=e.$moment(e.identify.bornDay).format("MM"),e.day=e.$moment(e.identify.bornDay).format("DD"),e.birthdayStart=e.$moment(e.identify.effDate).format("YYYY.MM.DD"),e.birthdayEnd=e.$moment(e.identify.expDate).format("YYYY.MM.DD"),console.log(),t.next=8,e.fitch(102,126,Object(f["a"])(e.identify.identityPic));case 8:return t.next=10,w()(e.$refs.idWrap,{allowTaint:!0,useCORS:!1});case 10:a=t.sent,e.baseImg=a.toDataURL("image/jpeg",1),console.log("身份证照片",e.baseImg),e.setIdentifyCardPicture(Object(f["b"])(e.baseImg)),e.isComplete=!0,e.getIdentifyCardImg();case 16:case"end":return t.stop()}}),t)})))()},methods:Object(s["a"])({},Object(d["c"])("common",["setIdentifyCardPicture"]),{fitch:function(e,t,a){var n=this;return new Promise((function(i){var r=document.createElement("img");r.onload=function(){var a=n.$refs.currentCanvas;a.width=e,a.height=t;var s=a.getContext("2d");s.drawImage(r,0,0);for(var d=s.getImageData(0,0,e,t),o=d.data,c=0;c<o.length;c+=4){var u=o[c],f=o[c+1],m=o[c+2];254===u&&254===f&&254===m&&(o[c+3]=0)}s.putImageData(d,0,0),i()},r.src=a}))}})},R=M,D=(a("8949"),a("2877")),E=Object(D["a"])(R,_,O,!1,null,"4af347d6",null),P=E.exports,A={name:"BeforeWorkIdentifyCardPage",props:["disableInput","disableReadCard","disableGetUserId","disableInputName","generateCard"],components:{idNumber:P},computed:Object(s["a"])({},Object(d["d"])("common",{binocularCamera:"binocularCamera",businessTypeCode:"businessTypeCode"}),{},Object(d["d"])("permanent",{BUSINESS_EN_NAME_CODE:"BUSINESS_EN_NAME_CODE",BUSINESS_CODE_NAME:"BUSINESS_CODE_NAME",identifyWebSocket:"identifyWebSocket",lightWebSocket:"lightWebSocket",cardReaderType:"cardReaderType"})),data:function(){return{cardNoBg:p.a,cardMove:h.a,cardNotBg:y.a,loading:null,currentState:1,tipShowFlag:!1,identifyCard:{},identifyName:"",identifyNameMatch:!1,identifyNum:"",identifyNumMatch:!1,tips:"请将二代身份证放置身份证阅读区",clockId:null,generateComplete:!1,readComplete:!1,httpComplete:!1}},mounted:function(){this.audioForget=Object(T["a"])(x.a),this.audioTake=Object(T["a"])(k.a),this.audioTakeNo=Object(T["a"])(I.a),this.disableReadCard?(this.audioForget.play(),this.currentState=0):this.disableInput||this.CONSTANT.localContrast?(this.audioTakeNo.play(),this.currentState=1,this.startReadCard()):(this.audioTake.play(),this.startReadCard()),this.setIdentifyCard({}),this.setBinocularCamera({})},beforeDestroy:function(){clearTimeout(this.clockId),Object(u["a"])(this.identifyWebSocket,null),Object(u["b"])(this.lightWebSocket,"lightCtrl@B4:OFF"),Object(c["t"])(),this.audioTake.destroy(),this.audioForget.destroy(),this.audioTakeNo.destroy()},methods:Object(s["a"])({},Object(d["c"])("common",["changeStep","changeTipPage","changeVisible","setIdentifyCard","setBinocularCamera","setUserRecognitionId"]),{backMenu:function(){this.changeVisible({visibleSteps:!1,visibleTip:!1,visibleBusinessName:!1,visibleJurisdiction:!1}),Object(C["a"])("/")},changIdentifyState:function(){this.currentState=this.currentState?0:1,this.currentState?(this.audioForget.pause(),this.audioTake.play(),this.startReadCard()):(this.audioTake.pause(),this.audioForget.play(),Object(u["a"])(this.identifyWebSocket,null),Object(u["b"])(this.lightWebSocket,"lightCtrl@B4:OFF"))},getIdentifyName:function(e){this.identifyName=e,this.identifyNameMatch=m["q"].name.test(this.identifyName)},getIdentifyNum:function(e){this.identifyNum=e,this.identifyNumMatch=m["q"].idNumber.test(this.identifyNum)},getIdentifyCardImg:function(){this.generateComplete=!0,this.readComplete&&this.httpComplete&&this.changeStep("down")},sureIdentifyNum:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.identifyCard=Object(f["c"])({identifyNum:e.identifyNum,identifyName:e.identifyName},"Handwriting"),t.next=3,e.saveUserInfo();case 3:case"end":return t.stop()}}),t)})))()},startReadCard:function(){var e=this;Object(u["b"])(this.lightWebSocket,"lightCtrl@B4:ON"),Object(u["a"])(this.identifyWebSocket,function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(a){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a||1!==a.code){t.next=17;break}if(console.log("身份证读卡器：",a),e.identifyCard=Object(f["c"])(a.result,e.cardReaderType),e.BUSINESS_EN_NAME_CODE.idCardOverdue!==e.businessTypeCode){t.next=11;break}if(n="您的身份证有效期为".concat(e.$moment(e.identifyCard.expDate).format("YYYY-MM-DD"),"，请在有效期三个月内办理期满换证。"),"长期"!==e.identifyCard.expDate){t.next=8;break}return e.changeTipPage({message:n}),t.abrupt("return",!1);case 8:if(!(e.$moment().unix()<e.$moment(e.identifyCard.expDate).subtract("3","months").unix())){t.next=11;break}return e.changeTipPage({message:n}),t.abrupt("return",!1);case 11:return e.readComplete=!0,e.CONSTANT.isOlin||(e.loading=e.$loading.full("正在处理中，请稍后......")),t.next=15,e.saveUserInfo();case 15:t.next=19;break;case 17:e.clockId&&(clearTimeout(e.clockId),e.clockId=null),e.clockId=setTimeout((function(){Object(u["b"])(e.identifyWebSocket,{directive:"ReadIdCard"})}),1e3);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Object(u["b"])(this.identifyWebSocket,{directive:"ReadIdCard"})},closeLoading:function(){this.loading&&this.loading.close()},saveUserInfo:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("身份证信息：",e.identifyCard),e.setIdentifyCard(e.identifyCard),e.disableGetUserId){t.next=16;break}return a={name:e.identifyCard.partyName,idNum:e.identifyCard.certNumber,idPhoto:e.identifyCard.identityPic,sex:e.identifyCard.gender,permanentAddress:e.identifyCard.certAddress,dateOfBirth:e.identifyCard.bornDay,begDate:e.identifyCard.effDate,endDate:e.identifyCard.expDate,nationCode:e.identifyCard.nationCode,nationName:e.identifyCard.nation,businessType:e.businessTypeCode,businessTypeName:e.BUSINESS_CODE_NAME[e.businessTypeCode]},t.next=6,Object(o["g"])(a);case 6:if(n=t.sent,!n||"0"!==n.code){t.next=13;break}return e.setUserRecognitionId(n.result.userRecognitionId),t.next=11,e.judgeNext();case 11:t.next=14;break;case 13:n&&e.changeTipPage({message:n.message});case 14:t.next=17;break;case 16:e.changeStep("down");case 17:e.closeLoading(),e.httpComplete=!0;case 19:case"end":return t.stop()}}),t)})))()},judgeNext:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.CONSTANT.location!==m["l"].suzhou){t.next=7;break}return t.next=3,Object(c["q"])({idNum:e.identifyCard.certNumber,businessType:e.businessTypeCode});case 3:a=t.sent,a&&"0"===a.code?e.isReadAndJudgeNext():a&&e.changeTipPage({message:a.message}),t.next=8;break;case 7:e.isReadAndJudgeNext();case 8:case"end":return t.stop()}}),t)})))()},isReadAndJudgeNext:function(){this.readComplete&&this.generateCard?this.generateComplete&&this.changeStep("down"):this.changeStep("down")}})},B=A,W=(a("54bf"),Object(D["a"])(B,n,i,!1,null,"30aaa776",null));t["a"]=W.exports}}]);
//# sourceMappingURL=chunk-56164606.51f050e7.js.map